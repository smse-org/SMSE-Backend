{
  "openapi": "3.0.0",
  "info": {
    "title": "SMSE Backend API",
    "description": "RESTful API for the SMSE project backend.",
    "version": "1.0.0"
  },
  "paths": {
    "/api/auth/register": {
      "post": {
        "summary": "Register a new user",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                },
                "required": [
                  "username",
                  "email",
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created successfully",
            "content": {
              "application/json": {
                "example": {
                  "msg": "User created successfully"
                }
              }
            }
          },
          "400": {
            "description": "Missing required fields or user already exists",
            "content": {
              "application/json": {
                "examples": {
                  "missing_fields": {
                    "value": {
                      "msg": "Missing required fields"
                    }
                  },
                  "username_exists": {
                    "value": {
                      "msg": "Username already exists"
                    }
                  },
                  "email_exists": {
                    "value": {
                      "msg": "Email already exists"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "summary": "Login a user and get a JWT token",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                },
                "required": [
                  "username",
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful, returns JWT token",
            "content": {
              "application/json": {
                "example": {
                  "access_token": "string"
                }
              }
            }
          },
          "401": {
            "description": "Invalid credentials",
            "content": {
              "application/json": {
                "example": {
                  "msg": "Invalid credentials"
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/refresh": {
      "post": {
        "summary": "Refresh JWT token",
        "description": "Refresh a JWT token.",
        "operationId": "refreshToken",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Token refreshed successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "access_token": {
                      "type": "string",
                      "description": "Newly issued access token."
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Token expired or invalid.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "msg": {
                      "type": "string",
                      "enum": [
                        "Token has expired",
                        "Invalid token"
                      ],
                      "description": "Error message indicating token expiration or invalidity."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/logout": {
      "post": {
        "summary": "Logout user",
        "description": "Logout a user and revoke the JWT token.",
        "operationId": "logoutUser",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Logout successful.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "msg": {
                      "type": "string",
                      "example": "Logout successful"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid token.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "msg": {
                      "type": "string",
                      "example": "Invalid token"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/protected": {
      "get": {
        "summary": "Protected route",
        "description": "A protected route that requires a valid JWT token.",
        "operationId": "getProtectedResource",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Returns the username of the authenticated user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "username": {
                      "type": "string",
                      "example": "johndoe"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized. Invalid or missing token.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "msg": {
                      "type": "string",
                      "example": "Invalid or missing token"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users/me": {
      "get": {
        "summary": "Get details of the authenticated user",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Returns user details",
            "content": {
              "application/json": {
                "example": {
                  "id": "integer",
                  "username": "string",
                  "email": "string",
                  "created_at": "string"
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "example": {
                  "message": "User not found"
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "Update authenticated user",
        "description": "Update the details of the authenticated user.",
        "operationId": "updateUser",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string",
                    "description": "New username for the user."
                  },
                  "email": {
                    "type": "string",
                    "description": "New email address for the user.",
                    "format": "email"
                  }
                },
                "required": [
                  "username",
                  "email"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "User updated successfully"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer",
                          "example": 1
                        },
                        "username": {
                          "type": "string",
                          "example": "johndoe"
                        },
                        "email": {
                          "type": "string",
                          "example": "johndoe@example.com"
                        },
                        "created_at": {
                          "type": "string",
                          "example": "2025-03-03T12:34:56Z"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request. Username or email already exists, or invalid email format.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "enum": [
                        "Username already exists",
                        "Email already exists",
                        "Invalid email address"
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "User not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "User not found"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete authenticated user",
        "description": "Delete the authenticated user.",
        "operationId": "deleteUser",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User deleted successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "User deleted successfully"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "User not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "User not found"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/contents": {
      "post": {
        "summary": "Upload a new content file",
        "description": "Upload a new content file. Embedding is now computed asynchronously and may be null initially.",
        "operationId": "createContent",
        "tags": [
          "Contents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "The content file to upload"
                  }
                },
                "required": [
                  "file"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Content created successfully. Embedding will be computed asynchronously.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content created successfully"
                    },
                    "content": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer",
                          "example": 1
                        },
                        "content_path": {
                          "type": "string",
                          "example": "/uploads/content123.mp4"
                        },
                        "content_tag": {
                          "type": "boolean",
                          "example": true
                        },
                        "content_size": {
                          "type": "number"
                        },
                        "upload_date": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    },
                    "task_id": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request (e.g., no file part, no selected file, file type not allowed).",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "msg": {
                      "type": "string",
                      "example": "No file part"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error creating content"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "Get all contents for the authenticated user",
        "tags": [
          "Contents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Returns a list of contents",
            "content": {
              "application/json": {
                "example": {
                  "contents": [
                    {
                      "id": "integer",
                      "content_path": "string",
                      "content_tag": "boolean"
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/contents/{content_id}": {
      "get": {
        "summary": "Get content by ID",
        "description": "Retrieve details of a specific content by its ID.",
        "operationId": "getContentById",
        "tags": [
          "Contents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "content_id",
            "in": "path",
            "required": true,
            "description": "ID of the content to retrieve",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Content details retrieved successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "content": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer",
                          "example": 1
                        },
                        "content_path": {
                          "type": "string",
                          "example": "/uploads/content123.mp4"
                        },
                        "content_tag": {
                          "type": "boolean",
                          "example": true
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Content not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content not found"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "Update content by ID",
        "description": "Update a specific content by its ID.",
        "operationId": "updateContentById",
        "tags": [
          "Contents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "content_id",
            "in": "path",
            "required": true,
            "description": "ID of the content to update",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "content_tag": {
                    "type": "boolean",
                    "example": true
                  }
                },
                "required": [
                  "content_tag"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Content updated successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content updated successfully"
                    },
                    "content": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer",
                          "example": 1
                        },
                        "content_path": {
                          "type": "string",
                          "example": "/uploads/content123.mp4"
                        },
                        "content_tag": {
                          "type": "boolean",
                          "example": true
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Content not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error updating content.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error updating content"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete content by ID",
        "description": "Delete a specific content by its ID.",
        "operationId": "deleteContentById",
        "tags": [
          "Contents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "content_id",
            "in": "path",
            "required": true,
            "description": "ID of the content to delete",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Content deleted successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content deleted successfully"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Content not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error deleting content.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error deleting content"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/contents/allowed_extensions": {
      "get": {
        "summary": "Get Allowed Extensions",
        "description": "Retrieve the list of allowed file extensions for content uploads.",
        "operationId": "getAllowedExtensions",
        "tags": [
          "Contents"
        ],
        "responses": {
          "200": {
            "description": "Returns the list of allowed extensions.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "allowed_extensions": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        ".jpg",
                        ".png",
                        ".mp4",
                        ".pdf"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/contents/download": {
      "get": {
        "summary": "Download content file",
        "description": "Download a specific content file by its ID or path for the current user.",
        "operationId": "downloadContent",
        "tags": [
          "Contents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "content_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            },
            "description": "The ID of the content to download"
          },
          {
            "name": "file_path",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "The full path of the content to download"
          }
        ],
        "responses": {
          "200": {
            "description": "File downloaded successfully.",
            "content": {
              "application/octet-stream": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "400": {
            "description": "Content ID or file path is required.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content ID or file path is required"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Unauthorized access.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Unauthorized access"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Content not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content not found"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/contents/thumbnail/{content_id}": {
      "get": {
        "summary": "Get content thumbnail",
        "description": "Serve a thumbnail for a specific content by its ID. This endpoint does not require authentication and returns a JPEG thumbnail image.",
        "operationId": "getContentThumbnail",
        "tags": [
          "Contents"
        ],
        "parameters": [
          {
            "name": "content_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "The ID of the content whose thumbnail to retrieve"
          }
        ],
        "responses": {
          "200": {
            "description": "Thumbnail served successfully.",
            "content": {
              "image/jpeg": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "404": {
            "description": "Content not found, thumbnail not available, or thumbnail file not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Content not found"
                    }
                  }
                },
                "examples": {
                  "content_not_found": {
                    "value": {
                      "message": "Content not found"
                    }
                  },
                  "thumbnail_not_available": {
                    "value": {
                      "message": "Thumbnail not available"
                    }
                  },
                  "thumbnail_file_not_found": {
                    "value": {
                      "message": "Thumbnail file not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error downloading or serving thumbnail.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error downloading thumbnail"
                    }
                  }
                },
                "examples": {
                  "download_error": {
                    "value": {
                      "message": "Error downloading thumbnail"
                    }
                  },
                  "serving_error": {
                    "value": {
                      "message": "Error serving thumbnail"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/search": {
      "post": {
        "summary": "Multipart Search Files",
        "description": "Search for files using multipart queries. Supports text queries, single/multiple file uploads, or a combination of both. The system computes embeddings for each part and combines them using arithmetic mean for semantic similarity search.",
        "operationId": "searchFiles",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10
            },
            "description": "Maximum number of results to return"
          },
          {
            "name": "modalities",
            "in": "query",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "text",
                  "image",
                  "audio"
                ]
              }
            },
            "description": "Filter results by specific modalities",
            "style": "form",
            "explode": true
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string",
                    "description": "Text query for semantic search",
                    "example": "find images of cats"
                  }
                },
                "additionalProperties": false
              },
              "examples": {
                "textOnly": {
                  "summary": "Text-only search",
                  "value": {
                    "query": "find images of cats"
                  }
                }
              }
            },
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string",
                    "description": "Optional text query to combine with file uploads",
                    "example": "find similar content"
                  },
                  "files": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "binary"
                    },
                    "description": "One or more files to search similar content for. Supports text, image, and audio files."
                  },
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "Single file upload (legacy support). Use 'files' for multiple files."
                  }
                },
                "additionalProperties": false
              },
              "examples": {
                "singleFile": {
                  "summary": "Single file search",
                  "description": "Search using a single file"
                },
                "multipleFiles": {
                  "summary": "Multiple files search", 
                  "description": "Search using multiple files of different modalities"
                },
                "textAndFiles": {
                  "summary": "Combined text and files search",
                  "description": "Search using both text query and file uploads"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search completed successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Search completed successfully"
                    },
                    "query_id": {
                      "type": "integer",
                      "example": 12345
                    },
                    "query_type": {
                      "type": "string",
                      "enum": [
                        "text",
                        "file", 
                        "multipart"
                      ],
                      "example": "multipart",
                      "description": "Type of query: 'text' for text-only, 'file' for single file, 'multipart' for multiple parts"
                    },
                    "query_parts": {
                      "type": "object",
                      "properties": {
                        "text": {
                          "type": "string",
                          "nullable": true,
                          "example": "find similar content",
                          "description": "Text part of the query if provided"
                        },
                        "files": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true,
                          "example": ["image1.jpg", "audio.mp3"],
                          "description": "List of uploaded file names if provided"
                        },
                        "total_parts": {
                          "type": "integer",
                          "example": 3,
                          "description": "Total number of query parts (text + files)"
                        }
                      }
                    },
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "content_id": {
                            "type": "integer",
                            "example": 6789
                          },
                          "content_path": {
                            "type": "string",
                            "example": "user123/uploads/document.pdf"
                          },
                          "content_tag": {
                            "type": "boolean",
                            "example": true
                          },
                          "similarity_score": {
                            "type": "number",
                            "format": "float",
                            "example": 0.8947,
                            "description": "Cosine similarity score between query and content"
                          }
                        }
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "limit": {
                          "type": "integer",
                          "example": 10
                        }
                      }
                    }
                  }
                },
                "examples": {
                  "textSearch": {
                    "summary": "Text-only search result",
                    "value": {
                      "message": "Search completed successfully",
                      "query_id": 12345,
                      "query_type": "text",
                      "query_parts": {
                        "text": "find images of cats",
                        "files": null,
                        "total_parts": 1
                      },
                      "results": [
                        {
                          "content_id": 101,
                          "content_path": "user1/uploads/cat_image.jpg",
                          "content_tag": true,
                          "similarity_score": 0.92
                        }
                      ],
                      "pagination": {
                        "limit": 10
                      }
                    }
                  },
                  "multipartSearch": {
                    "summary": "Multipart search result",
                    "value": {
                      "message": "Search completed successfully", 
                      "query_id": 12346,
                      "query_type": "multipart",
                      "query_parts": {
                        "text": "similar visual content",
                        "files": ["reference.jpg", "audio_sample.wav"],
                        "total_parts": 3
                      },
                      "results": [
                        {
                          "content_id": 202,
                          "content_path": "user1/uploads/similar_image.png",
                          "content_tag": true,
                          "similarity_score": 0.87
                        }
                      ],
                      "pagination": {
                        "limit": 10
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request. No valid query parts provided or unsupported file type.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "examples": [
                        "No valid query parts provided. Either query text or files are required",
                        "Unsupported file type '.xyz' in file 'test.xyz'. Allowed types: .txt, .pdf, .jpg, .png, .mp3, .wav"
                      ]
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error. Error processing query or creating embeddings.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "examples": [
                        "Error creating embedding for query",
                        "Error processing query: SMSE service unavailable",
                        "Error performing search: Database connection failed"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "Get Query History",
        "description": "Retrieve the search query history for the authenticated user.",
        "operationId": "getQueryHistory",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10
            },
            "description": "Maximum number of queries to return"
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 0
            },
            "description": "Number of queries to skip (for pagination)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully retrieved query history.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "queries": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer",
                            "example": 123
                          },
                          "text": {
                            "type": "string",
                            "example": "example search query"
                          },
                          "timestamp": {
                            "type": "string",
                            "format": "date-time",
                            "example": "2025-03-03T12:34:56Z"
                          }
                        }
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "total": {
                          "type": "integer",
                          "example": 45
                        },
                        "limit": {
                          "type": "integer",
                          "example": 10
                        },
                        "offset": {
                          "type": "integer",
                          "example": 0
                        },
                        "has_more": {
                          "type": "boolean",
                          "example": true
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/search/{query_id}": {
      "get": {
        "summary": "Get Search Results History",
        "description": "Retrieve the search results history for a specific query.",
        "operationId": "getSearchResultsHistory",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "query_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "The ID of the query to retrieve search results history for."
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully retrieved search results history.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "query": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer",
                          "example": 123
                        },
                        "text": {
                          "type": "string",
                          "example": "example search query"
                        },
                        "timestamp": {
                          "type": "string",
                          "format": "date-time",
                          "example": "2025-03-03T12:34:56Z"
                        }
                      }
                    },
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "content_id": {
                            "type": "integer",
                            "example": 456
                          },
                          "similarity_score": {
                            "type": "number",
                            "format": "float",
                            "example": 0.87
                          },
                          "retrieved_at": {
                            "type": "string",
                            "format": "date-time",
                            "example": "2025-03-03T12:40:00Z"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Query not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Query not found"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete Query",
        "description": "Deletes a specific query by its ID.",
        "operationId": "deleteQuery",
        "tags": [
          "Search"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "query_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "The ID of the query to delete."
          }
        ],
        "responses": {
          "200": {
            "description": "Query deleted successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Query deleted successfully"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Query not found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Query not found"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/tasks": {
      "get": {
        "summary": "Get all tasks for the authenticated user",
        "tags": [
          "Tasks"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Returns a list of tasks",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "tasks": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Task"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/tasks/{task_id}": {
      "get": {
        "summary": "Get task by ID",
        "description": "Retrieve details of a specific task by its ID.",
        "tags": [
          "Tasks"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "task_id",
            "in": "path",
            "required": true,
            "description": "ID of the task to retrieve",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Task details retrieved successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "task": {
                      "$ref": "#/components/schemas/Task"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Task not found.",
            "content": {
              "application/json": {}
            }
          }
        }
      }
    },
    "/api/user/preferences": {
      "get": {
        "summary": "Get user preferences",
        "description": "Retrieve all preferences for the authenticated user.",
        "operationId": "getUserPreferences",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Returns user preferences",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "preferences": {
                      "type": "object",
                      "additionalProperties": true,
                      "description": "The user's preferences as a JSON object"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "User not found"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "Update user preferences",
        "description": "Update preferences for the authenticated user.",
        "operationId": "updateUserPreferences",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true,
                "description": "Object containing preferences to update"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Preferences updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Preferences updated"
                    },
                    "preferences": {
                      "type": "object",
                      "additionalProperties": true,
                      "description": "The updated preferences"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "No data provided",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "No data provided"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "User not found"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Clear user preferences",
        "description": "Clear all preferences for the authenticated user.",
        "operationId": "clearUserPreferences",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "All preferences cleared successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "All preferences cleared"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "User not found"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "Task": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "task_id_123"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "in_progress",
              "completed"
            ]
          },
          "content_id": {
            "type": "integer",
            "example": 456
          },
          "assigned_to": {
            "type": "string",
            "example": "user_id_123"
          },
          "due_date": {
            "type": "string",
            "format": "date-time",
            "example": "2025-03-03T12:34:56Z"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-03-01T12:34:56Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-03-02T12:34:56Z"
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Authentication",
      "description": "Endpoints related to user authentication"
    },
    {
      "name": "Users",
      "description": "Endpoints for user management"
    },
    {
      "name": "Contents",
      "description": "Endpoints for managing content files"
    },
    {
      "name": "Search",
      "description": "Endpoints for managing search queries"
    },
    {
      "name": "Tasks",
      "description": "Endpoints for managing tasks"
    }
  ]
}